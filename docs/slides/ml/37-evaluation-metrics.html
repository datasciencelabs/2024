<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-12-04">
<meta name="keywords" content="Machine Learning">

<title>Evaluation Metrics – BST 260: Introduction to Data Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Evaluation Metrics</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../images/logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main">
    <a href="https://github.com/datasciencelabs/2024" title="GitHub" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Slides</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../psets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem Sets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../final-project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Final Project</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#evaluation-metrics" id="toc-evaluation-metrics" class="nav-link active" data-scroll-target="#evaluation-metrics">Evaluation metrics</a></li>
  <li><a href="#evaluation-metrics-1" id="toc-evaluation-metrics-1" class="nav-link" data-scroll-target="#evaluation-metrics-1">Evaluation metrics</a></li>
  <li><a href="#evaluation-metrics-2" id="toc-evaluation-metrics-2" class="nav-link" data-scroll-target="#evaluation-metrics-2">Evaluation metrics</a></li>
  <li><a href="#training-and-test-sets" id="toc-training-and-test-sets" class="nav-link" data-scroll-target="#training-and-test-sets">Training and test sets</a></li>
  <li><a href="#overall-accuracy" id="toc-overall-accuracy" class="nav-link" data-scroll-target="#overall-accuracy">Overall accuracy</a></li>
  <li><a href="#overall-accuracy-1" id="toc-overall-accuracy-1" class="nav-link" data-scroll-target="#overall-accuracy-1">Overall accuracy</a></li>
  <li><a href="#overall-accuracy-2" id="toc-overall-accuracy-2" class="nav-link" data-scroll-target="#overall-accuracy-2">Overall accuracy</a></li>
  <li><a href="#overall-accuracy-3" id="toc-overall-accuracy-3" class="nav-link" data-scroll-target="#overall-accuracy-3">Overall accuracy</a></li>
  <li><a href="#overall-accuracy-4" id="toc-overall-accuracy-4" class="nav-link" data-scroll-target="#overall-accuracy-4">Overall accuracy</a></li>
  <li><a href="#overall-accuracy-5" id="toc-overall-accuracy-5" class="nav-link" data-scroll-target="#overall-accuracy-5">Overall accuracy</a></li>
  <li><a href="#overall-accuracy-6" id="toc-overall-accuracy-6" class="nav-link" data-scroll-target="#overall-accuracy-6">Overall accuracy</a></li>
  <li><a href="#problem" id="toc-problem" class="nav-link" data-scroll-target="#problem">Problem</a></li>
  <li><a href="#the-confusion-matrix" id="toc-the-confusion-matrix" class="nav-link" data-scroll-target="#the-confusion-matrix">The confusion matrix</a></li>
  <li><a href="#the-confusion-matrix-1" id="toc-the-confusion-matrix-1" class="nav-link" data-scroll-target="#the-confusion-matrix-1">The confusion matrix</a></li>
  <li><a href="#the-confusion-matrix-2" id="toc-the-confusion-matrix-2" class="nav-link" data-scroll-target="#the-confusion-matrix-2">The confusion matrix</a></li>
  <li><a href="#the-confusion-matrix-3" id="toc-the-confusion-matrix-3" class="nav-link" data-scroll-target="#the-confusion-matrix-3">The confusion matrix</a></li>
  <li><a href="#sensitivity-and-specificity" id="toc-sensitivity-and-specificity" class="nav-link" data-scroll-target="#sensitivity-and-specificity">Sensitivity and specificity</a></li>
  <li><a href="#sensitivity-and-specificity-1" id="toc-sensitivity-and-specificity-1" class="nav-link" data-scroll-target="#sensitivity-and-specificity-1">Sensitivity and specificity</a></li>
  <li><a href="#sensitivity-and-specificity-2" id="toc-sensitivity-and-specificity-2" class="nav-link" data-scroll-target="#sensitivity-and-specificity-2">Sensitivity and specificity</a></li>
  <li><a href="#sensitivity-and-specificity-3" id="toc-sensitivity-and-specificity-3" class="nav-link" data-scroll-target="#sensitivity-and-specificity-3">Sensitivity and specificity</a></li>
  <li><a href="#sensitivity-and-specificity-4" id="toc-sensitivity-and-specificity-4" class="nav-link" data-scroll-target="#sensitivity-and-specificity-4">Sensitivity and specificity</a></li>
  <li><a href="#sensitivity-and-specificity-5" id="toc-sensitivity-and-specificity-5" class="nav-link" data-scroll-target="#sensitivity-and-specificity-5">Sensitivity and specificity</a></li>
  <li><a href="#sensitivity-and-specificity-6" id="toc-sensitivity-and-specificity-6" class="nav-link" data-scroll-target="#sensitivity-and-specificity-6">Sensitivity and specificity</a></li>
  <li><a href="#sensitivity-and-specificity-7" id="toc-sensitivity-and-specificity-7" class="nav-link" data-scroll-target="#sensitivity-and-specificity-7">Sensitivity and specificity</a></li>
  <li><a href="#balanced-accuracy-and-f_1-score" id="toc-balanced-accuracy-and-f_1-score" class="nav-link" data-scroll-target="#balanced-accuracy-and-f_1-score">Balanced accuracy and <span class="math inline">\(F_1\)</span> score</a></li>
  <li><a href="#balanced-accuracy-and-f_1-score-1" id="toc-balanced-accuracy-and-f_1-score-1" class="nav-link" data-scroll-target="#balanced-accuracy-and-f_1-score-1">Balanced accuracy and <span class="math inline">\(F_1\)</span> score</a></li>
  <li><a href="#balanced-accuracy-and-f_1-score-2" id="toc-balanced-accuracy-and-f_1-score-2" class="nav-link" data-scroll-target="#balanced-accuracy-and-f_1-score-2">Balanced accuracy and <span class="math inline">\(F_1\)</span> score</a></li>
  <li><a href="#balanced-accuracy-and-f_1-score-3" id="toc-balanced-accuracy-and-f_1-score-3" class="nav-link" data-scroll-target="#balanced-accuracy-and-f_1-score-3">Balanced accuracy and <span class="math inline">\(F_1\)</span> score</a></li>
  <li><a href="#balanced-accuracy-and-f_1-score-4" id="toc-balanced-accuracy-and-f_1-score-4" class="nav-link" data-scroll-target="#balanced-accuracy-and-f_1-score-4">Balanced accuracy and <span class="math inline">\(F_1\)</span> score</a></li>
  <li><a href="#balanced-accuracy-and-f_1-score-5" id="toc-balanced-accuracy-and-f_1-score-5" class="nav-link" data-scroll-target="#balanced-accuracy-and-f_1-score-5">Balanced accuracy and <span class="math inline">\(F_1\)</span> score</a></li>
  <li><a href="#balanced-accuracy-and-f_1-score-6" id="toc-balanced-accuracy-and-f_1-score-6" class="nav-link" data-scroll-target="#balanced-accuracy-and-f_1-score-6">Balanced accuracy and <span class="math inline">\(F_1\)</span> score</a></li>
  <li><a href="#roc-and-precision-recall-curves" id="toc-roc-and-precision-recall-curves" class="nav-link" data-scroll-target="#roc-and-precision-recall-curves">ROC and precision-recall curves</a></li>
  <li><a href="#roc-and-precision-recall-curves-1" id="toc-roc-and-precision-recall-curves-1" class="nav-link" data-scroll-target="#roc-and-precision-recall-curves-1">ROC and precision-recall curves</a></li>
  <li><a href="#roc-and-precision-recall-curves-2" id="toc-roc-and-precision-recall-curves-2" class="nav-link" data-scroll-target="#roc-and-precision-recall-curves-2">ROC and precision-recall curves</a></li>
  <li><a href="#mean-squared-error" id="toc-mean-squared-error" class="nav-link" data-scroll-target="#mean-squared-error">Mean Squared Error</a></li>
  <li><a href="#mean-squared-error-1" id="toc-mean-squared-error-1" class="nav-link" data-scroll-target="#mean-squared-error-1">Mean Squared Error</a></li>
  <li><a href="#mean-squared-error-2" id="toc-mean-squared-error-2" class="nav-link" data-scroll-target="#mean-squared-error-2">Mean Squared Error</a></li>
  <li><a href="#mean-squared-error-3" id="toc-mean-squared-error-3" class="nav-link" data-scroll-target="#mean-squared-error-3">Mean Squared Error</a></li>
  <li><a href="#mean-squared-error-4" id="toc-mean-squared-error-4" class="nav-link" data-scroll-target="#mean-squared-error-4">Mean Squared Error</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/datasciencelabs/2024/blob/main/slides/ml/37-evaluation-metrics.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="37-evaluation-metrics.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Evaluation Metrics</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 4, 2024</p>
    </div>
  </div>
  
    
  </div>
  

<div>
  <div class="keywords">
    <div class="block-title">Keywords</div>
    <p>Machine Learning</p>
  </div>
</div>

</header>


<section id="evaluation-metrics" class="level2">
<h2 class="anchored" data-anchor-id="evaluation-metrics">Evaluation metrics</h2>
<ul>
<li><p>Here we describe ways in which machine learning algorithms are evaluated.</p></li>
<li><p>We need to quantify what we mean when we say an algorithm performs better.</p></li>
<li><p>We demonstrate with a boring and simple example: how to predict sex using height.</p></li>
</ul>
</section>
<section id="evaluation-metrics-1" class="level2">
<h2 class="anchored" data-anchor-id="evaluation-metrics-1">Evaluation metrics</h2>
<ul>
<li><p>We introduce the <strong>caret</strong> package, which provides useful functions to facilitate machine learning in R.</p></li>
<li><p>We describe <strong>caret</strong> it in more detail later</p></li>
</ul>
</section>
<section id="evaluation-metrics-2" class="level2">
<h2 class="anchored" data-anchor-id="evaluation-metrics-2">Evaluation metrics</h2>
<ul>
<li>For our first example, we use the height data provided by the <strong>dslabs</strong> package.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret) </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dslabs) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>We start by defining the outcome and predictors.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> heights<span class="sc">$</span>sex </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> heights<span class="sc">$</span>height </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="training-and-test-sets" class="level2">
<h2 class="anchored" data-anchor-id="training-and-test-sets">Training and test sets</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2007</span>) </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>test_index <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(y, <span class="at">times =</span> <span class="dv">1</span>, <span class="at">p =</span> <span class="fl">0.25</span>, <span class="at">list =</span> <span class="cn">FALSE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>We can use the result of the <code>createDataPartition</code> function call to define the training and test sets as follows:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>test_set <span class="ot">&lt;-</span> heights[test_index, ] </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>train_set <span class="ot">&lt;-</span> heights[<span class="sc">-</span>test_index, ] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="overall-accuracy" class="level2">
<h2 class="anchored" data-anchor-id="overall-accuracy">Overall accuracy</h2>
<ul>
<li>Let’s start by developing the simplest possible machine algorithm: guessing the outcome.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>y_hat <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>), <span class="fu">length</span>(test_index), <span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">factor</span>(<span class="at">levels =</span> <span class="fu">levels</span>(test_set<span class="sc">$</span>sex)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>The <em>overall accuracy</em> is simply defined as the overall proportion that is predicted correctly:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(y_hat <span class="sc">==</span> test_set<span class="sc">$</span>sex) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.479</code></pre>
</div>
</div>
</section>
<section id="overall-accuracy-1" class="level2">
<h2 class="anchored" data-anchor-id="overall-accuracy-1">Overall accuracy</h2>
<ul>
<li><p>Can we do better?</p></li>
<li><p>Exploratory data analysis suggests we can because, on average, males are slightly taller than females:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>heights <span class="sc">|&gt;</span> <span class="fu">group_by</span>(sex) <span class="sc">|&gt;</span> <span class="fu">summarize</span>(<span class="at">avg =</span> <span class="fu">mean</span>(height), <span class="at">sd =</span> <span class="fu">sd</span>(height)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  sex      avg    sd
  &lt;fct&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 Female  64.9  3.76
2 Male    69.3  3.61</code></pre>
</div>
</div>
<ul>
<li>How do we make use of this insight?</li>
</ul>
</section>
<section id="overall-accuracy-2" class="level2">
<h2 class="anchored" data-anchor-id="overall-accuracy-2">Overall accuracy</h2>
<ul>
<li>Let’s try another simple approach: predict <code>Male</code> if height is within two standard deviations from the average male.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>y_hat <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(x <span class="sc">&gt;</span> <span class="dv">62</span>, <span class="st">"Male"</span>, <span class="st">"Female"</span>), <span class="fu">levels</span>(test_set<span class="sc">$</span>sex)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>The accuracy goes up from 0.50 to about 0.80:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(y <span class="sc">==</span> y_hat) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.793</code></pre>
</div>
</div>
<ul>
<li>But can we do even better?</li>
</ul>
</section>
<section id="overall-accuracy-3" class="level2">
<h2 class="anchored" data-anchor-id="overall-accuracy-3">Overall accuracy</h2>
<ul>
<li>Here we examine the accuracy of 10 different cutoffs and pick the one yielding the best result:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>cutoff <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">61</span>, <span class="dv">70</span>) </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">&lt;-</span> <span class="fu">sapply</span>(cutoff, <span class="cf">function</span>(x){ </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  y_hat <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(train_set<span class="sc">$</span>height <span class="sc">&gt;</span> x, <span class="st">"Male"</span>, <span class="st">"Female"</span>), <span class="at">levels =</span> <span class="fu">levels</span>(test_set<span class="sc">$</span>sex)) </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(y_hat <span class="sc">==</span> train_set<span class="sc">$</span>sex) </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>}) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="overall-accuracy-4" class="level2">
<h2 class="anchored" data-anchor-id="overall-accuracy-4">Overall accuracy</h2>
<ul>
<li>We can make a plot showing the accuracy obtained on the training set for males and females:</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="37-evaluation-metrics_files/figure-html/accuracy-vs-cutoff-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="overall-accuracy-5" class="level2">
<h2 class="anchored" data-anchor-id="overall-accuracy-5">Overall accuracy</h2>
<ul>
<li>We see that the maximum value is:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(accuracy) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.834</code></pre>
</div>
</div>
<ul>
<li><p>which is much higher than 0.5.</p></li>
<li><p>The cutoff resulting in this accuracy is:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>best_cutoff <span class="ot">&lt;-</span> cutoff[<span class="fu">which.max</span>(accuracy)] </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>best_cutoff </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 64</code></pre>
</div>
</div>
</section>
<section id="overall-accuracy-6" class="level2">
<h2 class="anchored" data-anchor-id="overall-accuracy-6">Overall accuracy</h2>
<ul>
<li>We can now test this cutoff on our test set to make sure our accuracy is not overly optimistic:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>y_hat <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(test_set<span class="sc">$</span>height <span class="sc">&gt;</span> best_cutoff, <span class="st">"Male"</span>, <span class="st">"Female"</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">factor</span>(<span class="at">levels =</span> <span class="fu">levels</span>(test_set<span class="sc">$</span>sex)) </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>y_hat <span class="ot">&lt;-</span> <span class="fu">factor</span>(y_hat) </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(y_hat <span class="sc">==</span> test_set<span class="sc">$</span>sex) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.806</code></pre>
</div>
</div>
<ul>
<li><p>The estimate of accuracy is biased due to slight over-training.</p></li>
<li><p>But ultimately we tested on a dataset that we did not train on.</p></li>
</ul>
</section>
<section id="problem" class="level2">
<h2 class="anchored" data-anchor-id="problem">Problem</h2>
<ul>
<li>The prediction rule we developed in the previous section predicts <code>Male</code> if the student is taller than 64 inches.</li>
</ul>
</section>
<section id="the-confusion-matrix" class="level2">
<h2 class="anchored" data-anchor-id="the-confusion-matrix">The confusion matrix</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="at">data =</span> y_hat, <span class="at">reference =</span> test_set<span class="sc">$</span>sex) </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>cm<span class="sc">$</span>table </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Reference
Prediction Female Male
    Female     24   15
    Male       36  188</code></pre>
</div>
</div>
<ul>
<li>If we study this table closely, it reveals a problem.</li>
</ul>
</section>
<section id="the-confusion-matrix-1" class="level2">
<h2 class="anchored" data-anchor-id="the-confusion-matrix-1">The confusion matrix</h2>
<ul>
<li>If we compute the accuracy separately we get:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>cm<span class="sc">$</span>byClass[<span class="fu">c</span>(<span class="st">"Sensitivity"</span>, <span class="st">"Specificity"</span>)] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sensitivity Specificity 
      0.400       0.926 </code></pre>
</div>
</div>
</section>
<section id="the-confusion-matrix-2" class="level2">
<h2 class="anchored" data-anchor-id="the-confusion-matrix-2">The confusion matrix</h2>
<ul>
<li><p>This is because the <em>prevalence</em> of males is high.</p></li>
<li><p>These heights were collected from three data sciences courses, two of which had higher male enrollment:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>cm<span class="sc">$</span>byClass[<span class="st">"Prevalence"</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Prevalence 
     0.228 </code></pre>
</div>
</div>
<ul>
<li><p>So when computing overall accuracy, the high percentage of mistakes made for females is outweighed by the gains in correct calls for men.</p></li>
<li><p>This type of bias can actually be a big problem in practice.</p></li>
<li><p>If your training data is biased in some way, you are likely to develop algorithms that are biased as well.</p></li>
</ul>
</section>
<section id="the-confusion-matrix-3" class="level2">
<h2 class="anchored" data-anchor-id="the-confusion-matrix-3">The confusion matrix</h2>
<ul>
<li><p>The fact that we used a test set does not matter because it is also derived from the original biased dataset.</p></li>
<li><p>This is one of the reasons we look at metrics other than overall accuracy when evaluating a machine learning algorithm.</p></li>
<li><p>A general improvement to using overall accuracy is to study <em>sensitivity</em> and <em>specificity</em> separately.</p></li>
</ul>
</section>
<section id="sensitivity-and-specificity" class="level2">
<h2 class="anchored" data-anchor-id="sensitivity-and-specificity">Sensitivity and specificity</h2>
<ul>
<li><p>Need binary outcome.</p></li>
<li><p><em>Sensitivity</em> is defined as the ability of an algorithm to predict a positive outcome when the actual outcome is positive: <span class="math inline">\(\hat{y}=1\)</span> when <span class="math inline">\(y=1\)</span>.</p></li>
<li><p>Because an algorithm that calls everything positive has perfect sensitivity, this metric on its own is not enough to judge an algorithm.</p></li>
<li><p><em>Specificity</em>, is the ability of an algorithm to not predict a positive <span class="math inline">\(\hat{y}=0\)</span> when the actual outcome is not a positive <span class="math inline">\(y=0\)</span>.</p></li>
</ul>
</section>
<section id="sensitivity-and-specificity-1" class="level2">
<h2 class="anchored" data-anchor-id="sensitivity-and-specificity-1">Sensitivity and specificity</h2>
<ul>
<li><p>We can summarize in the following way:</p></li>
<li><p>High sensitivity: <span class="math inline">\(y=1 \implies \hat{y}=1\)</span>.</p></li>
<li><p>High specificity: <span class="math inline">\(y=0 \implies \hat{y} = 0\)</span>.</p></li>
<li><p>Although the above is often considered the definition of specificity, another way to think of specificity is by the proportion of positive calls that are actually positive:</p></li>
<li><p>High specificity: <span class="math inline">\(\hat{y}=1 \implies y=1\)</span>.</p></li>
</ul>
</section>
<section id="sensitivity-and-specificity-2" class="level2">
<h2 class="anchored" data-anchor-id="sensitivity-and-specificity-2">Sensitivity and specificity</h2>
<ul>
<li>To provide precise definitions, we name the four entries of the confusion matrix:</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'kableExtra'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    group_rows</code></pre>
</div>
<div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Actually Positive</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Actually Negative</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Predicted positive</td>
<td style="text-align: left;">True positives (TP)</td>
<td style="text-align: left;">False positives (FP)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Predicted negative</td>
<td style="text-align: left;">False negatives (FN)</td>
<td style="text-align: left;">True negatives (TN)</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="sensitivity-and-specificity-3" class="level2">
<h2 class="anchored" data-anchor-id="sensitivity-and-specificity-3">Sensitivity and specificity</h2>
<ul>
<li><p>Sensitivity is typically quantified by <span class="math inline">\(TP/(TP+FN)\)</span>.</p></li>
<li><p>This quantity is referred to as the <em>true positive rate</em> (TPR) or <em>recall</em>.</p></li>
<li><p>Specificity is defined as <span class="math inline">\(TN/(TN+FP)\)</span>.</p></li>
<li><p>This quantity is also called the true negative rate (TNR).</p></li>
</ul>
</section>
<section id="sensitivity-and-specificity-4" class="level2">
<h2 class="anchored" data-anchor-id="sensitivity-and-specificity-4">Sensitivity and specificity</h2>
<ul>
<li><p>There is another way of quantifying specificity which is <span class="math inline">\(TP/(TP+FP)\)</span></p></li>
<li><p>This quantity is referred to as <em>positive predictive value (PPV)</em> and also as <em>precision</em>.</p></li>
<li><p>Note that, unlike TPR and TNR, precision depends on prevalence since higher prevalence implies you can get higher precision even when guessing.</p></li>
<li><p>The multiple names can be confusing, so we include a table to help us remember the terms.</p></li>
</ul>
</section>
<section id="sensitivity-and-specificity-5" class="level2">
<h2 class="anchored" data-anchor-id="sensitivity-and-specificity-5">Sensitivity and specificity</h2>
<p><font size="5"></font></p><font size="5">
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 10%">
<col style="width: 20%">
<col style="width: 16%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th>Measure of</th>
<th>Name_1</th>
<th>Name_2</th>
<th>Definition</th>
<th>Probability representation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>sensitivity</td>
<td>TPR</td>
<td>Recall</td>
<td><span class="math inline">\(\frac{\mbox{TP}}{\mbox{TP} + \mbox{FN}}\)</span></td>
<td><span class="math inline">\(\mbox{Pr}(\hat{Y}=1 \mid Y=1)\)</span></td>
</tr>
<tr class="even">
<td>specificity</td>
<td>TNR</td>
<td>1-FPR</td>
<td><span class="math inline">\(\frac{\mbox{TN}}{\mbox{TN}+\mbox{FP}}\)</span></td>
<td><span class="math inline">\(\mbox{Pr}(\hat{Y}=0 \mid Y=0)\)</span></td>
</tr>
<tr class="odd">
<td>specificity</td>
<td>PPV</td>
<td>Precision</td>
<td><span class="math inline">\(\frac{\mbox{TP}}{\mbox{TP}+\mbox{FP}}\)</span></td>
<td><span class="math inline">\(\mbox{Pr}(Y=1 \mid \hat{Y}=1)\)</span></td>
</tr>
</tbody>
</table>
</font><p><font size="5"></font></p>
</section>
<section id="sensitivity-and-specificity-6" class="level2">
<h2 class="anchored" data-anchor-id="sensitivity-and-specificity-6">Sensitivity and specificity</h2>
<ul>
<li>The <strong>caret</strong> function <code>confusionMatrix</code> computes all these metrics:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>cm<span class="sc">$</span>overall[<span class="st">"Accuracy"</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy 
   0.806 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>cm<span class="sc">$</span>byClass[<span class="fu">c</span>(<span class="st">"Sensitivity"</span>,<span class="st">"Specificity"</span>, <span class="st">"Prevalence"</span>)] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sensitivity Specificity  Prevalence 
      0.400       0.926       0.228 </code></pre>
</div>
</div>
</section>
<section id="sensitivity-and-specificity-7" class="level2">
<h2 class="anchored" data-anchor-id="sensitivity-and-specificity-7">Sensitivity and specificity</h2>
<ul>
<li><p>Because prevalence is low, failing to predict actual females as females (low sensitivity) does not lower the overall accuracy as much as failing to predict actual males as males (low specificity).</p></li>
<li><p>This is an example of why it is important to examine sensitivity and specificity and not just accuracy.</p></li>
<li><p>Before applying this algorithm to general datasets, we need to ask ourselves if prevalence will be the same.</p></li>
</ul>
</section>
<section id="balanced-accuracy-and-f_1-score" class="level2">
<h2 class="anchored" data-anchor-id="balanced-accuracy-and-f_1-score">Balanced accuracy and <span class="math inline">\(F_1\)</span> score</h2>
<p><span class="math display">\[
\frac{1}{\frac{1}{2}\left(\frac{1}{\mbox{recall}} +  
    \frac{1}{\mbox{precision}}\right) }
\]</span></p>
</section>
<section id="balanced-accuracy-and-f_1-score-1" class="level2">
<h2 class="anchored" data-anchor-id="balanced-accuracy-and-f_1-score-1">Balanced accuracy and <span class="math inline">\(F_1\)</span> score</h2>
<ul>
<li>Because it is easier to write, you often see this harmonic average rewritten as:</li>
</ul>
<p><span class="math display">\[
2 \times \frac{\mbox{precision} \cdot \mbox{recall}}
{\mbox{precision} + \mbox{recall}}
\]</span></p>
</section>
<section id="balanced-accuracy-and-f_1-score-2" class="level2">
<h2 class="anchored" data-anchor-id="balanced-accuracy-and-f_1-score-2">Balanced accuracy and <span class="math inline">\(F_1\)</span> score</h2>
<ul>
<li>The <span class="math inline">\(F_1\)</span>-score can be adapted to weigh specificity and sensitivity differently.</li>
</ul>
<p><span class="math display">\[
\frac{1}{\frac{\beta^2}{1+\beta^2}\frac{1}{\mbox{recall}} +  
    \frac{1}{1+\beta^2}\frac{1}{\mbox{precision}} }
\]</span></p>
</section>
<section id="balanced-accuracy-and-f_1-score-3" class="level2">
<h2 class="anchored" data-anchor-id="balanced-accuracy-and-f_1-score-3">Balanced accuracy and <span class="math inline">\(F_1\)</span> score</h2>
<ul>
<li><p>The <code>F_meas</code> function in the <strong>caret</strong> package computes this summary with <code>beta</code> defaulting to 1.</p></li>
<li><p>Let’s rebuild our prediction algorithm, but this time maximizing the F-score instead of overall accuracy:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>cutoff <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">61</span>, <span class="dv">70</span>) </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>F_1 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(cutoff, <span class="cf">function</span>(x){ </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  y_hat <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(train_set<span class="sc">$</span>height <span class="sc">&gt;</span> x, <span class="st">"Male"</span>, <span class="st">"Female"</span>), <span class="fu">levels</span>(test_set<span class="sc">$</span>sex)) </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">F_meas</span>(<span class="at">data =</span> y_hat, <span class="at">reference =</span> <span class="fu">factor</span>(train_set<span class="sc">$</span>sex)) </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>}) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="balanced-accuracy-and-f_1-score-4" class="level2">
<h2 class="anchored" data-anchor-id="balanced-accuracy-and-f_1-score-4">Balanced accuracy and <span class="math inline">\(F_1\)</span> score</h2>
<ul>
<li>As before, we can plot these <span class="math inline">\(F_1\)</span> measures versus the cutoffs:</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="37-evaluation-metrics_files/figure-html/f_1-vs-cutoff-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="balanced-accuracy-and-f_1-score-5" class="level2">
<h2 class="anchored" data-anchor-id="balanced-accuracy-and-f_1-score-5">Balanced accuracy and <span class="math inline">\(F_1\)</span> score</h2>
<ul>
<li>We see that it is maximized at <span class="math inline">\(F_1\)</span> value of:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(F_1) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.614</code></pre>
</div>
</div>
<ul>
<li>This maximum is achieved when we use the following cutoff:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>best_cutoff <span class="ot">&lt;-</span> cutoff[<span class="fu">which.max</span>(F_1)] </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>best_cutoff </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 66</code></pre>
</div>
</div>
<ul>
<li>A cutoff of 66 makes more sense than 64.</li>
</ul>
</section>
<section id="balanced-accuracy-and-f_1-score-6" class="level2">
<h2 class="anchored" data-anchor-id="balanced-accuracy-and-f_1-score-6">Balanced accuracy and <span class="math inline">\(F_1\)</span> score</h2>
<ul>
<li>Furthermore, it balances the specificity and sensitivity of our confusion matrix:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>y_hat <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(test_set<span class="sc">$</span>height <span class="sc">&gt;</span> best_cutoff, <span class="st">"Male"</span>, <span class="st">"Female"</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">factor</span>(<span class="at">levels =</span> <span class="fu">levels</span>(test_set<span class="sc">$</span>sex)) </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sensitivity</span>(<span class="at">data =</span> y_hat, <span class="at">reference =</span> test_set<span class="sc">$</span>sex) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.633</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">specificity</span>(<span class="at">data =</span> y_hat, <span class="at">reference =</span> test_set<span class="sc">$</span>sex) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.857</code></pre>
</div>
</div>
<ul>
<li>We now see that we do much better than guessing, that both sensitivity and specificity are relatively high.</li>
</ul>
</section>
<section id="roc-and-precision-recall-curves" class="level2">
<h2 class="anchored" data-anchor-id="roc-and-precision-recall-curves">ROC and precision-recall curves</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="37-evaluation-metrics_files/figure-html/roc-3-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="roc-and-precision-recall-curves-1" class="level2">
<h2 class="anchored" data-anchor-id="roc-and-precision-recall-curves-1">ROC and precision-recall curves</h2>
<ul>
<li>The packages <strong>pROC</strong> and <strong>plotROC</strong> are useful for generating these plots.</li>
</ul>
</section>
<section id="roc-and-precision-recall-curves-2" class="level2">
<h2 class="anchored" data-anchor-id="roc-and-precision-recall-curves-2">ROC and precision-recall curves</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="37-evaluation-metrics_files/figure-html/precision-recall-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="mean-squared-error" class="level2">
<h2 class="anchored" data-anchor-id="mean-squared-error">Mean Squared Error</h2>
<ul>
<li><p>Up to now we have described evaluation metrics that apply exclusively to categorical data.</p></li>
<li><p>Specifically, for binary outcomes, we have described how sensitivity, specificity, accuracy, and <span class="math inline">\(F_1\)</span> can be used as quantification.</p></li>
<li><p>However, these metrics are not useful for continuous outcomes.</p></li>
<li><p>In this section, we describe how the general approach to defining “best” in machine learning is to define a <em>loss function</em>, which can be applied to both categorical and continuous data.</p></li>
</ul>
</section>
<section id="mean-squared-error-1" class="level2">
<h2 class="anchored" data-anchor-id="mean-squared-error-1">Mean Squared Error</h2>
<ul>
<li>Most commont metric to minimize is mean squared error (MSE):</li>
</ul>
<p><span class="math display">\[
\text{MSE} \equiv \mbox{E}\{(\hat{Y} - Y)^2 \}
\]</span></p>
<ul>
<li>How do we estimate this?</li>
</ul>
</section>
<section id="mean-squared-error-2" class="level2">
<h2 class="anchored" data-anchor-id="mean-squared-error-2">Mean Squared Error</h2>
<ul>
<li>Because in practice we have tests set with many, say <span class="math inline">\(N\)</span>, independent observations, a commonly used observable estimate of the MSE is:</li>
</ul>
<p><span class="math display">\[
\hat{\mbox{MSE}} = \frac{1}{N}\sum_{i=1}^N (\hat{y}_i - y_i)^2
\]</span></p>
<ul>
<li>with the <span class="math inline">\(\hat{y}_i\)</span> generated completely independently from the the <span class="math inline">\(y_i\)</span>.</li>
</ul>
<hr>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In practice, we often report the root mean squared error (RMSE), which is simply <span class="math inline">\(\sqrt{\mbox{MSE}}\)</span>, because it is in the same units as the outcomes.</p>
</div>
</div>
</section>
<section id="mean-squared-error-3" class="level2">
<h2 class="anchored" data-anchor-id="mean-squared-error-3">Mean Squared Error</h2>
<ul>
<li><p>The estimate <span class="math inline">\(\hat{\text{MSE}}\)</span> is a random variable.</p></li>
<li><p><span class="math inline">\(\text{MSE}\)</span> and <span class="math inline">\(\hat{\text{MSE}}\)</span> are often referred to as the true error and apparent error, respectively.</p></li>
<li><p>It is difficult to derive the statistical properties of how well the apparent error estimates the true error.</p></li>
<li><p>We later introduce cross-validation an approach to estimating the MSE.</p></li>
</ul>
</section>
<section id="mean-squared-error-4" class="level2">
<h2 class="anchored" data-anchor-id="mean-squared-error-4">Mean Squared Error</h2>
<ul>
<li><p>There are loss functions other than the squared loss.</p></li>
<li><p>For example, the <em>Mean Absolute Error</em> uses absolute values, <span class="math inline">\(|\hat{Y}_i - Y_i|\)</span> instead of squaring the errors.</p></li>
<li><p><span class="math inline">\((\hat{Y}_i - Y_i)^2\)</span>.</p></li>
<li><p>However, in this book we focus on minimizing square loss since it is the most widely used.</p></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("http:\/\/datasciencelabs\.github\.io\/2024");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/datasciencelabs/2024/blob/main/slides/ml/37-evaluation-metrics.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></div></div></footer></body></html>